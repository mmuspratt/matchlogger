<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayingTimeLogger</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        .player {
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .player.active {
            background-color: #a0d0a0;
        }
        .player-label {
            display: inline-block;
            width: 50px;
            font-weight: bold;
        }
        .clock {
            display: inline-block;
            padding: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        .clock.active {
            background-color: #a0d0a0;
        }
        #export-button, #stop-all-button, #reset-button {
            margin-top: 20px;
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        #export-button {
            background-color: #007BFF;
        }
        #stop-all-button {
            background-color: #DC3545;
        }
        #reset-button {
            background-color: #FFC107;
            color: black;
        }
        #active-clocks-counter {
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        #active-clocks-count {
            color: red;
        }
    </style>
</head>
<body>

    <h1>PlayingTimeLogger</h1>

    <div id="active-clocks-counter">Active Clocks: <span id="active-clocks-count">0</span></div>

    <div id="players">
        <!-- Players will be added here dynamically -->
    </div>

    <button id="export-button" onclick="exportTimes()">Export Times</button>
    <button id="stop-all-button" onclick="stopAllClocks()">Stop All Clocks</button>
    <button id="reset-button" onclick="resetClocks()">Reset Clocks</button>

    <script>
        const positions = ['GK', 'D', 'M', 'F'];
        const players = [
            { name: 'Charlie', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Colby', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Davin', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Elliot', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Emory', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Eske', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Finn', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Ivar', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Leo', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Lucas', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Matthew', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Noah', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} },
            { name: 'Weston', clocks: { GK: 0, D: 0, M: 0, F: 0 }, intervals: {} }
        ];

        let activeClocks = 0;
        const activeClocksCounter = document.getElementById('active-clocks-counter');
        const activeClocksCount = document.getElementById('active-clocks-count');
        const container = document.getElementById('players');

        players.forEach((player, index) => {
            const playerRow = document.createElement('div');
            playerRow.className = 'player';
            playerRow.id = `player-${index}`;

            const playerLabel = document.createElement('span');
            playerLabel.className = 'player-label';
            playerLabel.innerText = player.name;
            playerRow.appendChild(playerLabel);

            positions.forEach(position => {
                const clockDiv = document.createElement('div');
                clockDiv.className = 'clock';
                clockDiv.id = `clock-${index}-${position}`;
                clockDiv.innerText = `${position}: 00:00`;
                clockDiv.addEventListener('click', () => toggleTimer(index, position));
                playerRow.appendChild(clockDiv);
            });

            container.appendChild(playerRow);
        });

        function toggleTimer(playerIndex, position) {
            const player = players[playerIndex];
            const clockDiv = document.getElementById(`clock-${playerIndex}-${position}`);

            if (!player.intervals[position]) {
                // Start the timer
                player.intervals[position] = setInterval(() => updateDisplay(playerIndex, position), 100);
                player.clocks[position] = Date.now();
                clockDiv.classList.add('active');
                activeClocks++;
            } else {
                // Stop the timer
                clearInterval(player.intervals[position]);
                player.intervals[position] = null;
                player.clocks[position] = (Date.now() - player.clocks[position]) / 1000;
                clockDiv.classList.remove('active');
                clockDiv.innerText = `${position}: ${formatTime(player.clocks[position])}`;
                activeClocks--;
            }
            updateActiveClocksCounter();
        }

        function updateDisplay(playerIndex, position) {
            const player = players[playerIndex];
            const clockDiv = document.getElementById(`clock-${playerIndex}-${position}`);
            let elapsedTime = player.clocks[position];

            if (player.intervals[position]) {
                elapsedTime = (Date.now() - elapsedTime) / 1000;
            }

            clockDiv.innerText = `${position}: ${formatTime(elapsedTime)}`;
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function timeInDecimalMinutes(seconds) {
            return (seconds / 60).toFixed(2);
        }

        function exportTimes() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Player,Position,Time (MM:SS),Time (Minutes)\n";

            players.forEach(player => {
                positions.forEach(position => {
                    const timeFormatted = formatTime(player.clocks[position]);
                    const timeDecimal = timeInDecimalMinutes(player.clocks[position]);
                    csvContent += `${player.name},${position},${timeFormatted},${timeDecimal}\n`;
                });
            });

            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');

            const filename = `player_times_${year}-${month}-${day}.csv`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link); // Required for Firefox

            link.click();
            document.body.removeChild(link); // Clean up
        }

        function resetClocks() {
            players.forEach((player, index) => {
                positions.forEach(position => {
                    clearInterval(player.intervals[position]);
                    player.clocks[position] = 0;
                    player.intervals[position] = null;
                    const clockDiv = document.getElementById(`clock-${index}-${position}`);
                    clockDiv.innerText = `${position}: 00:00`;
                    clockDiv.classList.remove('active');
                });
            });
            activeClocks = 0;
            updateActiveClocksCounter();
        }

        function stopAllClocks() {
            players.forEach((player, index) => {
                positions.forEach(position => {
                    if (player.intervals[position]) {
                        clearInterval(player.intervals[position]);
                        player.clocks[position] = (Date.now() - player.clocks[position]) / 1000;
                        player.intervals[position] = null;
                        const clockDiv = document.getElementById(`clock-${index}-${position}`);
                        clockDiv.classList.remove('active');
                        clockDiv.innerText = `${position}: ${formatTime(player.clocks[position])}`;
                        activeClocks--;
                    }
                });
            });
            updateActiveClocksCounter();
        }

        function updateActiveClocksCounter() {
            activeClocksCount.innerText = activeClocks;
            if (activeClocks === 9) {
                activeClocksCount.style.color = 'green';
            } else {
                activeClocksCount.style.color = 'red';
            }
        }
    </script>

</body>
</html>
